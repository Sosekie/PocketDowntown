# Pocketdowntown

## Introduction
“口袋商业街”是我小学时候非常喜欢的手机经营游戏。那时，我就在想：开出租车过程很繁琐，如果有算法可以实现出租车的自动驾驶就好了。到了研究生阶段，我发现实现这些功能其实并不难，于是我开始动手尝试。
此项目还实现了自动进货功能。

## Method&Update
### 2023/11/18
1. 使用`Anlink`等应用将手机画面投影到电脑上；
2. 将整张电脑截图作为输入，判断图片中有无对应目标图像，获取对应图像的位置区域，然后输入给`pyautogui`库进行鼠标点击和按下放开等操作，来实现对游戏中出租车的自动驾驶；
3. 驾驶过程中不对乘客要去的地点和当前地点进行判断，而采用每次移动一小步就停下的方式，对所有楼房进行遍历（一趟大概花费一分钟）。
### 2023/11/19
1. 改为获取手机画面位置以取代整张图片作为输入，速度提升很多，一次template查找耗时大约0.28秒；
2. 封装了大部分函数，简化代码；
3. 在行驶过程中增加是否还可以继续行驶的判断，而不是等待固定时间结束才停止点击；车辆停止时间需满足0.5秒才可触发下车判断，`0.5-last_time`可防止因判断而导致的时间浪费;
4. 通过出租车的位置获得了目的地的相对位置，得到目的地数字图片；
### 2023/11/20
1. 通过mask图片上方三分之二部分来查找下方任意一个蓝色方块并点击；
2. 通过mask图片下方三分之一部分，以及左右各三分之一部分区域，来查找中间区域有无需要进货的商店；
3. 两次点击进入商店，查找有无“进货”选项，点击并关闭窗口；
4. 循环执行直到遍历完所有需要进行的操作。
### 2023/11/20
1. 拖动屏幕来遍历所有商店，查找是否需要自行补货；
2. 尝试识别售空的商品，但是失败，改用逐个点击查看是否可以进货；
3. 改为二分查找，每个循环判断是从左到右还是相反，只检查一半的商店，以缩短时间。
### 2023/11/21
1. “以及左右各三分之一部分区域”改为各五分之二，因为我的手机屏幕最多显示五个商店，所以只需要保留中间的商店即可。

## Pip list

```bash
pip install -r requirements.txt
```

## Run
在根目录中执行以下命令来启动脚本：
```bash
python main.py
```

![Result](screen.png)
